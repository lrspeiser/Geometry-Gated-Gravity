# Shell-based Gravity Enhancement on SPARC: Optimization, Results, and Overlays

Authors: Leonard R. Speiser et al.
Date: 2025-09-16
Repository: https://github.com/lrspeiser/GravityCalculator

Abstract
We investigate a shell-based gravity enhancement model as an alternative to scaling baryonic rotation curves using a simple inverse mass–gravity power law. Using SPARC rotation curves, we perform a grid search with a local refinement to determine shell-model parameters that best reproduce observed velocities in outer galactic regions. The best refined parameters achieve a median per-point closeness of 81.0% and reduce the average percent-off relative to the GR baseline by 14.47% across outer points, outperforming GR in ~72% of points. We provide summary metrics across morphological categories and illustrative overlays for representative galaxies.

1. Datasets and Preprocessing
- Primary dataset: SPARC rotation curves (Lelli et al. 2016c). Local copies in data/.
- Access paths used in this work:
  - Parquet curves: data/sparc_rotmod_ltg.parquet
  - SPARC MasterSheet: data/Rotmod_LTG/MasterSheet_SPARC.csv
  - Alternative MRT file (fallback): data/SPARC_Lelli2016c.mrt
- Preprocessing script used to regenerate parquet: src/scripts/build_sparc_parquet.py

2. Models
2.1 Baseline (GR scaling)
- Observed vs baryonic comparison uses a computed Vgr_kms (GR baseline) from the dataset’s baryonic components.
- Percent off per point is computed as |Vpred - Vobs| / Vobs * 100.

2.2 Shell-based Gravity Enhancement (experimental)
- Model parameters:
  - mass_exp (exponent on reference mass scaling)
  - middle (enhancement in an intermediate shell region)
  - max (capped maximum enhancement at large radii)
- Implementation: src/scripts/sparc_predict.py (flag --model shell)
- Prediction: Vpred = Vbar * sqrt(G_pred), where G_pred is piecewise smoothed and energy-capped by middle and max.

3. Optimization Procedure
- Script: src/scripts/optimize_shell.py
- Coarse grid:
  - mass_exp ∈ {-0.50, -0.35, -0.20}
  - middle ∈ {1.50, 2.00, 2.50}
  - max ∈ {3.50, 4.50, 5.50}
- Refinement: local sweep around the coarse best with neighborhood steps:
  - mass_exp ±{0.10, 0.05, 0, +0.05, +0.10}, clamped to [-1.5, 0.0]
  - middle ±{0.50, 0.25, 0, +0.25, +0.50}, clamped to [1.0, 4.0]
  - max ±{1.0, 0.5, 0, +0.5, +1.0}, clamped to [2.0, 8.0]
- Command used (Makefile target): make optimize-shell
- Outputs written under data/opt_shell/ including:
  - opt_summary.csv (all runs)
  - best_params.json (best after refinement)
  - Per-run directories with CSVs and diagnostics

4. Best Refined Parameters and Global Metrics
- Best refined parameters (from data/opt_shell/best_params.json):
  - mass_exp: -0.40
  - middle: 2.50
  - max: 4.00
  - Output dir: data/opt_shell/refine__me_-0.400__mid_2.50__max_4.00
- Key global metrics (outer-region points):
  - Mean closeness (per point): 74.79%
  - Median closeness (per point): 81.01%
  - Fraction of points with closeness ≥ 90%: 19.60%
  - Mean of per-galaxy medians: 71.79%
  - Median of per-galaxy medians: 79.92%
  - Fraction of galaxies with median closeness ≥ 90%: 19.43%
  - Average GR percent-off: 39.68%
  - Average Model percent-off: 25.21%
  - Absolute improvement vs GR: 14.47% (points)
  - Fraction of points where model beats GR: 72.08%

5. Category-Level Highlights (outer-region aggregates)
Selected entries from sparc_summary_by_type.csv (best run):
- Im (dwarf irregular): model avg off 28.95% (median 19.49%) vs GR avg off 40.87%
- Sd (dwarf spiral): model avg off 16.62% (median 13.75%) vs GR avg off 46.58%
- Scd (dwarf spiral): model avg off 22.90% (median 23.17%) vs GR avg off 38.77%
- Sbc (ultra-light): model avg off 6.14% (median 6.95%) vs GR avg off 23.21%

6. Overlay Figures
- Generated by src/scripts/plot_overlays.py
- Command used:
  make plot-overlays IN_DIR=data/opt_shell/refine__me_-0.400__mid_2.50__max_4.00 \
      OUT_DIR=reports/figures/opt_shell_refine_-0.40_2.50_4.00
- Representative galaxies (subset shown below):

![DDO154](reports/figures/opt_shell_refine_-0.40_2.50_4.00/DDO154.png)
![IC2574](reports/figures/opt_shell_refine_-0.40_2.50_4.00/IC2574.png)
![NGC2403](reports/figures/opt_shell_refine_-0.40_2.50_4.00/NGC2403.png)
![NGC3198](reports/figures/opt_shell_refine_-0.40_2.50_4.00/NGC3198.png)
![NGC6503](reports/figures/opt_shell_refine_-0.40_2.50_4.00/NGC6503.png)
![ESO079-G014](reports/figures/opt_shell_refine_-0.40_2.50_4.00/ESO079-G014.png)

7. Methodological Notes
- Outer-region criterion is based on a per-galaxy boundary_kpc, with metrics computed on rows where is_outer is True.
- percent_close is computed per point as 100 * (1 - |Vpred - Vobs| / max(Vobs, eps)).
- Robustness: Multiple refined neighbors of the best parameters yield similar metrics, indicating a shallow optimum plateau.

8. Reproducibility
- Environment: Python 3.x with numpy, pandas, matplotlib, pyarrow, astropy, scipy, PyQt6 (see requirements.txt).
- Commands:
  - Coarse + refine search: make optimize-shell
  - Overlays (subset or full): make plot-overlays IN_DIR=<best_out_dir> OUT_DIR=<fig_dir>
- Outputs stored under data/opt_shell/ and reports/figures/ (PNGs tracked via Git LFS per .gitattributes).

9. Limitations and Future Work
- The shell model is an experimental formulation. Further theoretical grounding and parameter priors should be explored.
- Consider cross-validation that withholds entire galaxies, and compare against the density-based model family (src/scripts/sparc_density_models.py).
- Expand overlays to include additional morphologies and automated selection by residual patterns.

10. Data and Code Availability
- Code: repository root (see paths above). Figures and artifacts committed to main with Git LFS for large files.
- For any use of web services or API keys in later work, place instructions in README and reference them in code comments.
